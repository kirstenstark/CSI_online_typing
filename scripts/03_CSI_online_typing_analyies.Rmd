---
title: "03_CSI_online_typing_analysis"
author: "Kirsten Stark"
date: "2/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load packages
```{r}
library(dplyr)
library(tidyr)
library(lme4)
library(lmerTest)
library(Rmisc)
library(Cairo)
#library(strengejacke)
library(ggplot2)

options(scipen=999)

rm(list = ls())
```


## Load and preprocess data

```{r}
options( "encoding" = "UTF-8" )

# input 
input = "data_long.csv"

# load data
df <- read.csv(here::here("data", input))
```

Check amount of participants and trials and exclude fillers
```{r}
# no. of participants: 
length(unique(df$subject))

# no. of trials is 160 per participant? 
nrow(df) == 160 * length(unique(df$subject))

# exclude rows with filler trials
#df <- df %>% filter(category != "Filler")
#nrow(df)/length(unique(df$subject)) # 120 Trials per participant
```

Factorize columns

```{r}
# factorize columns
is.numeric(df$timing.01)
df$PosOr <- as.factor(df$PosOr)
df$subject <- as.factor(df$subject)
```

## Check participants answer behavior
```{r}
answers <- data.frame(df$subject, df$item, df$word) %>%
  dplyr:: rename(item = df.item, word = df.word) %>%
  mutate(item =  toupper(item)) %>% 
  mutate(word = toupper(word))
sum(is.na(answers$word))
# percentage of trials where participants didn't enter anything
sum(is.na(answers$word))/nlevels(df$subject)

# when item and word are exactly identical, the answer is correct
answers <- answers %>% filter(item != word)

# if entry was submitted by enter key, delete 'Enter'
answers <- answers %>% mutate(word = case_when(
    endsWith(word, "ENTER") ~ stringr::str_sub(word, end = -6),
    !endsWith(word, "ENTER") ~ word))
answers <- answers %>% filter(item != word)

# if entry was submitted by space bar, delete 'space'
answers <- answers %>% mutate(word = case_when(
    endsWith(word, " ") ~ stringr::str_sub(word, end = -2),
    !endsWith(word, " ") ~ word))
answers <- answers %>% filter(item != word)

# answers that we still consider as correct: 
# 1) synonyms
# 2) typos or corrections that should not affect first letter timing

# Select typos that we accept as correct for typing onsets
answers.sort <- with(answers,  answers[order(item) , ])
answers <- answers %>% filter(
   word != "ALBACKSPACEAL", # Item = AAL
   word != "AL", # Item = AAL
   word != "AMIBACKSPACEEISE", # Item = AMEISE
   word != "A;EBACKSPACEBACKSPACEMEISE", # Item = AMEISE
   word != "AMEISTBACKSPACEE", # Item = AMEISE
   word != "AMAEISBACKSPACEBACKSPACEBACKSPACEBACKSPACEEISE", # Item = AMEISE
   word != "ARMEISE", # Item = AMEISE
   word != "AMOFELBACKSPACEBACKSPACEBACKSPACEPFBACKSPACEBACKSPACEBACKSPACEPFBACKSPACEEL", # Item = AMPEL
   word != "APFEKBACKSPACEL", # Item = APFEL
   word != "AARBACKSPACEBACKSPACERM", # Item = ARM
   word != "ARMABBACKSPACEBACKSPACEBAND", # Item = ARMBAND
   word != "ARMREIF", # Item = ARMBAND
   word != "ARMKETTE", # Item = ARMBAND
   word != "KITTEL", # Item = ARZTKITTEL
   word != "KITTEL", # Item = ARZTKITTEL
   word != "KITTEL", # Item = ARZTKITTEL
   word != "ATBACKSPACERZTKITTEL", # Item = ARZTKITTEL
   word != "KITTEL", # Item = ARZTKITTEL
   word != "KITTEL", # Item = ARZTKITTEL
   word != "KITTEL", # Item = ARZTKITTEL
   word != "AZBACKSPACERZTKITTEL", # Item = ARZTKITTEL
   word != "ABACKSPACEKITTEL", # Item = ARZTKITTEL
   word != "AUTPBACKSPACEO", # Item = AUTO
   word != "AUTOPBACKSPACE", # Item = AUTO
   word != "AXRBACKSPACET", # Item = AXT
   word != "AKBACKSPACEXTXBACKSPACEBACKSPACET", # Item = AXT
   word != "ACBACKSPACEXT", # Item = AXT
   word != "AX", # Item = AXT
   word != "AXTRBACKSPACE", # Item = AXT
   word != "BABY'BACKSPACE", # Item = BABY
   word != "BABVBACKSPACEY", # Item = BABY
   word != "BABZBACKSPACEY", # Item = BABY
   word != "BADEWBACKSPACEWANNE", # Item = BADEWANNE
   word != "BADWBACKSPACEEWANNE", # Item = BADEWANNE
   word != "WANNE", # Item = BADEWANNE
   word != "WBACKSPACEBASBACKSPACEDEWANNE", # Item = BADEWANNE
   word != "WANNE", # Item = BADEWANNE
   word != "BAÖLBACKSPACEBACKSPACELL", # Item = BALL
   word != "BANANABACKSPACEE", # Item = BANANE
   word != "BABABACKSPACEBACKSPACENANE", # Item = BANANE
   word != "BANEBACKSPACEANE", # Item = BANANE
   word != "BNBACKSPACEBACKSPACEBANANE", # Item = BANANE
   word != "BANANENBACKSPACEBACKSPACEBACKSPACENE", # Item = BANANE
   word != "BRBACKSPACEANK", # Item = BANK
   word != "BAN", # Item = BANK
   word != "BANKÄBACKSPACE", # Item = BANK
   word != "BÄT", # Item = BÄR
   word != "BABACKSPACEÄR", # Item = BÄR
   word != "BRBACKSPACEÄR", # Item = BÄR
   word != "BÖRBACKSPACEBACKSPACEÄR", # Item = BÄR
   word != "BRBACKSPACEÄR", # Item = BÄR
   word != "BÄRENTERENTER BACKSPACEENTERBACKSPACEBACKSPACEBACKSPACEBÄRENTERENTERENTERENTER", # Item = BÄR
   word != "BECEBACKSPACEHER", # Item = BECHER
   word != "BESSENBACKSPACEBACKSPACEBACKSPACEEN", # Item = BESEN
   word != "BEIBACKSPACEBACKSPACEIENE", # Item = BIENE
   word != "BRINBACKSPACEBACKSPACEBACKSPACEIRNE", # Item = BIRNE
   word != "BRBACKSPACEIRNE", # Item = BIRNE
   word != "BLEISCHBACKSPACEBACKSPACETIFT", # Item = BLEISTIFT
   word != "BLEISTFBACKSPACEIFT", # Item = BLEISTIFT
   word != "STIFT", # Item = BLEISTIFT
   word != "BEISBACKSPACEBACKSPACELBACKSPACEBACKSPACELEISTIFT", # Item = BLEISTIFT
   word != "BLEISTIFTT", # Item = BLEISTIFT
   word != "STIFT", # Item = BLEISTIFT
   word != "BLE$IBACKSPACEBACKSPACEISTIFT", # Item = BLEISTIFT
   word != "BLEIFSTBACKSPACEBACKSPACEBACKSPACESTIFT", # Item = BLEISTIFT
   word != "BELISTIFT", # Item = BLEISTIFT
   word != "BLEISTIFTEBACKSPACE", # Item = BLEISTIFT
   word != "BOHRER", # Item = BOHRMASCHINE
   word != "BORHER", # Item = BOHRMASCHINE
   word != "BOIBACKSPACEHRMASCHINE", # Item = BOHRMASCHINE
   word != "BOHR", # Item = BOHRMASCHINE
   word != "BOHRER", # Item = BOHRMASCHINE
   word != "BOHRER", # Item = BOHRMASCHINE
   word != "BORBACKSPACEHRMASCHINE", # Item = BOHRMASCHINE
   word != "BOHRMASCHIENE", # Item = BOHRMASCHINE
   word != "BOHRER", # Item = BOHRMASCHINE
   word != "BORHER", # Item = BOHRMASCHINE
   word != "BOHRER", # Item = BOHRMASCHINE
   word != "BORBACKSPACEHRMASCHINE", # Item = BOHRMASCHINE
   word != "BOBBACKSPACENBON", # Item = BONBON
   word != "BONBONNBACKSPACE", # Item = BONBON
   word != "BOBBACKSPACENBON", # Item = BONBON
   word != "BONOBACKSPACEBON", # Item = BONBON
   word != "BIBACKSPACEONBON", # Item = BONBON
   word != "BOBNBACKSPACEBACKSPACENBON", # Item = BONBON
   word != "BONOBACKSPACEBON", # Item = BONBON
   word != "BRIEFKASTERNBACKSPACEBACKSPACEN", # Item = BRIEFKASTEN
   word != "BRIEFKATSBACKSPACEBACKSPACESTEN", # Item = BRIEFKASTEN
   word != "BRIEFKASENBACKSPACEBACKSPACETEN", # Item = BRIEFKASTEN
   word != "BVBACKSPACERIEFKASTEN", # Item = BRIEFKASTEN
   word != "BIRBACKSPACEBACKSPACERIEFMARKE", # Item = BRIEFMARKE
   word != "BRIEGBACKSPACEFMARKE", # Item = BRIEFMARKE
   word != "BIRBACKSPACEBACKSPACERILLÖEBACKSPACEBACKSPACEE", # Item = BRILLE
   word != "BROKOLI", # Item = BROKKOLI
   word != "BROKKBACKSPACEOLI", # Item = BROKKOLI
   word != "BROKOLLI", # Item = BROKKOLI
   word != "BBROKKOLI", # Item = BROKKOLI
   word != "BORBACKSPACEBACKSPACEROKKOLI", # Item = BROKKOLI
   word != "BROKOLLI", # Item = BROKKOLI
   word != "BROKOLI", # Item = BROKKOLI
   word != "BROSSCHBACKSPACEBACKSPACEBACKSPACECHE", # Item = BROSCHE

  # (Typos from Pretest)
                              word != "ARMAND", # Item = Armband
                               word != "ARZTKIZEBACKSPACEBACKSPACETTEL", # Item = Arztkittel
                               word != "AUTP", # Item = Auto
                               word != "ACCBACKSPACEBACKSPACEXT", # Item = Axt
                               word != "BABANBACKSPACEBACKSPACEBACKSPACENANE", # Item = Banane
                               word != "BANANAEBACKSPACEBACKSPACEE", # Item = Banane
                               word != "BAKBACKSPACENK", # Item = Bank
                               word != "BANLBACKSPACEK+", # Item = Bank
                               word != "BÖRBACKSPACEBACKSPACEÄR", # Item = Bär
                               word != "BOHRER", # Item = Bohrmaschine
                               word != "BONOBON", # Item = Bonbon
                               word != "BRKBACKSPACEOKKOLI", # Item = Brokkoli
                               word != "BROCHBACKSPACEBACKSPACESCHE", # Item = Brosche, 
                               word != "BURH", # Item = BURG
                               word != "SOFA", # Item = COUCH
                               word != "SOBACKSPACEBACKSPACEBACKSPACECOBACKSPACEBACKSPACEBACKSPACECOUCH", # Item = Couch
                               word != "DAUENBACKSPACENENWESTE", # Item = DAUNENWESTE
                               word != "WESTE", # Item = DAUNENWESTE
                               word != "WEBACKSPACEBACKSPACESHIFTDAUNENWESTE", # Item = DAUNENWESTE
                               word != "FEIEBACKSPACELE", # Item = FEILE
                               word != "FUSSBACKSPACES", # Item = Fuss
                               word != "GEABEBACKSPACEBACKSPACEBACKSPACEBACKSPACEABEL", # Item = Gabel
                               word != "SPÜLMASCHINE", # Item = GESCHIRRSPÜLER	
                               word != "GESCHRIBACKSPACEBACKSPACEIRRSPÜLER", # Item = Geschirrspüler
                               word != "GOLDFISH", # Item =Goldfisch
                               word != "GLBACKSPACEOLDSBACKSPACEFISCH", # Item = Goldfisch)
                               word != "FISCH", # Item = Goldfisch
                               word != "GONEBACKSPACEDLE", # Item =GONDEL
                               word != "HOCHHAUSEBACKSPACE", # Item =HOCHHAUS
                               word != "HPCKER", # Item =HOCKER
                               word != "KAFFEMASCHINE", # Item =KAFFEEMASCHINE
                               word != "KAFFEMBACKSPACEEMASCHINE", # Item = KAFFEEMASCHINE	
                               word != "TEEKANNE",# Item = KANNE
                               word != "KAPUZEPULLI",# Item = KAPUZENPULLI	
                               word != "KATBACKSPACEROTTE",# Item = KAROTTE
                               word != "KAROTEBACKSPACETE",# Item = KAROTTE
                               word != "KARTOFFELL",# Item = KARTOFFEL
                               word != "SUPPENKELLE",# Item = KELLE
                               word != "BÜRLOKLAMEMR",# Item = KLAMMER
                               word != "BÜROKLAMMER",# Item = KLAMMER
                               word != "SCHRANK",# Item = KLEIDERSCHRANK	
                               word != "TOPRTE",# Item = KUCHEN
                               word != "KUTZSBACKSPACEBACKSPACESCHE",# Item = KUTSCHE
                               word != "LINRBACKSPACEEAL",# Item = LINEAL
                               word != "LÖGFFEL",# Item = LÖFFEL
                               word != "LÖSEBACKSPACEBACKSPACEWE",# Item = LÖWE
                               word != "MIRKOWELLE",# Item = MIKROWELLE
                               word != "MIKBACKSPACERBACKSPACEKROWELLE",# Item = MIKROWELLE	
                               word != "MIGBACKSPACERBACKSPACEKROWELLE",# Item = MIKROWELLE 
                               word != "MPOTORRAD",# Item = MOTORRAD
                               word != "PAPRIKE",# Item = PAPRIKA
                               word != "PARPIKA", # Item = PAPRIKA
                               word != "MANTEL",# Item = PELZMANTEL
                               word != "PERBACKSPACELZMANTEL",# Item = PELZMANTEL	
                               word != "RADIERHUMMEBACKSPACEI",# Item = RADIERGUMMI	
                               word != "REABACKSPACEGAL",# Item = REGAL
                              word !=  "ROCHENENTERENTERENTERENTERENTERENTERENTERENTERENTERENTERENTER",# Item = ROCHEN
                               word != "SAEBACKSPACEFE",# Item = SAFE
                               word != "SAKKO7BACKSPACE",# Item = SAKKO
                               word != "KISTE",# Item = SCHACHTEL
                              word !=  "SPATEN",# Item = SCHAUFEL
                              word != "SCHOLOLADE",# Item =  SCHOKOLADE
                             word !=  "SCHOKOLOBACKSPACEASDBACKSPACEBACKSPACEDE", # Item = SCHOKOLADE
                              word != "SCHRAUVENZIEHER", # Item = SCHRAUBENZIEHER
                              word != "SEGELSSCBACKSPACEBACKSPACECHIFF", # Item = SEGELSCHIFF	
                              word != "SCHIFF", # Item = SEGELSCHIFF	
                              word != "SEGELBOOT", # Item = SEGELSCHIFF	
                              word != "SESSEÖ", # Item = SESSEL
                              word != "SONNENBLIME", # Item = SONNENBLUME	
                              word != "KAFFEETASSE", # Item = TASSE
                              word != "TAIBACKSPACEUBE", # Item = TAUBE
                              word != "TEPEL", # Item = TEMPEL
                              word != "TRAUBE", # Item = TRAUBEN
                              word != "TRAUEBNBACKSPACEBACKSPACEBACKSPACEBEN", # Item = TRAUBEN 
                              word != "TUPBACKSPACELPE", # Item = TULPE
                              word != "USHIFTBOOT", # Item = U-BOOT
                              word != "U-SHIFTBOOT", # Item = U-BOOT
                              word != "BOOT", # Item = YACHT
                             #Filler 
                              word != "WANNE", # Item =  BADEWANNE
                              word != "BEBACKSPACEADEWANNE", # Item =  BADEWANNE
                              word != "BRIEFKSBACKSPACEASTEN", # Item =  BRIEFKASTEN	
                             word !=  "BREIFBACKSPACEBACKSPACEBACKSPACEIEFKASTEN", # Item =  BRIEFKASTEN	
                             word !=  "BRIEFMARE", # Item =  BRIEFMARKE	
                             word !=  "BRILLLBACKSPACEE", # Item =  BRILLE
                              word != "BIBACKSPACERILLE", # Item =  BRILLE
                              word != "FECBACKSPACEBACKSPACEÄCHER", # Item =  FÄCHER
                              word != "FEBACKSPACEÄCHER", # Item =  FÄCHER
                              word != "FENSTER+BACKSPACE", # Item =  FENSTER
                              word != "FOTOAPPARAT", # Item =  KAMERA
                              word != "KASSEEBACKSPACETTE", # Item =  KASSETTE
                              word != "KASETTE", # Item =  KASSETTE
                              word != "KOPFHÖRRBACKSPACEER", # Item =  KOPFHÖRER
                              word != "KISSEN", # Item =  KOPFKISSEN
                              word != "BALLON", # Item =  LUFTBALLON	
                             word !=  "MIKROPHON", # Item =  MIKROFON
                              word != "PARGUM", # Item =  PARFUM
                              word != "PFEIGE", # Item =  PFEIFE
                             word !=  "SCHORNSETBACKSPACEBACKSPACEBACKSPACESTEIN", # Item =  SCHORNSTEIN	
                              word != "SCJBACKSPACEHORNTEIN", # Item =  SCHORNSTEIN
                             word !=  "DOLCH", # Item =  SCHWERT
                             word != "DOCLH", # Item =  SCHWERT
                             word !=  "STREICHHOLFBACKSPACEZ", # Item =  STREICHHOLZ	
                              word != "ZIGARTEBACKSPACEBACKSPACEETTE", # Item =  ZIGARETTE
                             word !=  "ZIGARTEBACKSPACEBACKSPACEABACKSPACEETTEENTER" # Item =  ZIGARETTE
)

# These 881 entries will be considered as incorrect 
(answers)

# Set incorrect entries to NA in data frame
sum(is.na(df$word))
for(i in 1:nrow(df)) {
  if(is.na(df$word[i])){
    df$correct[i] <- NA
  } else {
    df$correct[i] <- 1
  }}

for (i in 1:nrow(answers)) {
  df$correct[df$subject == answers$df.subject[i] & 
            df$item == tolower(answers$item[i])] <- NA
}

# # adapt ordinal position for fillers: by mini-block (5 fillers per mini-block)
# table(df$PosOr)
# count <- 1
# for (i in 1:nrow(df)) {
#   if(df$category [i] == "Filler") {
#     df$PosOr[i] <- count
#     count <- count+1
#   }
#   if(count == 6) {  count <- 1}
# }
# table(df$PosOr)

# # set ordinal position to NA for unvalid trials
# for(i in 1:nrow(df_red)) {
#   if(is.na(df_red$word[i])) {
#     df_red$PosOr[i] <- NA
#   }}
# #sum(is.na(df_red$PosOr))

# factorize columns
is.numeric(df$timing.01)
df$PosOr <- as.factor(df$PosOr)
df$subject <- as.factor(df$subject)

# pretest only: save data frame with incorrect trials set to NA 
#write.csv(df, here::here("data", "pretest_long_correct.csv"))

```

## How many trial onset times are considered as invalid?

```{r}
# Percentage of NA or excluded trials
(sumna <- sum(is.na(df$correct)))
(percentagena <- sum(is.na(df$correct))/nrow(df))
```

In a total of `r sumna` participants did not enter anything or entered a chunks of letters that were not considered as correct based on the preregistered criteria. This is `r percentagena` % of all trials.   
  
How many trials per participant
```{r}
#Amount of trials with no entry for timing.01
as.data.frame(table(df$subject, is.na(df$timing.01))) %>% 
  dplyr::rename(subject = Var1, totaltrials = Var2, correct = Freq) %>%
  mutate(totaltrials = 160) %>% mutate(percentagecorrect = correct/totaltrials)

```


```{r}
#Amount of correct trials: 
as.data.frame(table(df$subject, is.na(df$correct))) %>% 
  dplyr::rename(subject = Var1, totaltrials = Var2, correct = Freq) %>%
  mutate(totaltrials = 160) %>% mutate(percentagecorrect = correct/totaltrials)

```


# ALL TRIALS
### Plot RTs by OrPos

```{r}
is.numeric(df$timing.01)
df$PosOr <- as.factor(df$PosOr)
df$subject <- as.factor(df$subject)
# descriptives 
(means <- Rmisc::summarySEwithin(df[df$category != "Filler" ,],"timing.01",idvar = "subject",withinvars = "PosOr", na.rm = T))
```


Make plots suitable for APA format, font sizes can be adjusted
```{r}
apatheme <- theme_bw()+
  theme(plot.title=element_text(family="Arial",size=22,hjust = .5),
        panel.grid.major=element_blank(), panel.grid.minor=element_blank(),
        panel.border=element_blank(),axis.line=element_line(),
        text=element_text(family="Arial",size=16))
```


```{r}
plotting <- df %>%
  mutate(kind = case_when(category == "Filler" ~"Filler",
                          category != "Filler" ~"Experimental"))
(plot <- ggplot(data=df[df$category != "Filler" ,], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms")+
  annotate(geom="text", x=2, y=1200, label="n = 4", color="black", size = 8))

(plot <- ggplot(data=plotting, aes(x=PosOr, y=timing.01, group = kind, color = kind)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms", color = "Trial type")+
  annotate(geom="text", x=2, y=1380, label="n = 30", color="black", size = 8))


# ggsave(plot = plot, file = "figures/RT_across_conditions.pdf", device = cairo_pdf, dpi = 300)
# embedFonts(file = "figures/RT_across_conditions_CSI_online_typing.pdf")
```
  
Plot by subcategory
```{r}

(plot_by_cat <- ggplot(data=df[df$category != "Filler" ,], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  facet_wrap(~category) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms"))
#ggsave(plot = plot30_facet, file = "Plots/CSI_subcats.pdf", device = cairo_pdf,dpi = 300)
#embedFonts(file = "Plots/CSI_online30_subcats.pdf")

```

Plot by subject: 
```{r}

(plot_by_cat <- ggplot(data=df[df$category != "Filler" ,], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  facet_wrap(~subject) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms"))
#ggsave(plot = plot30_facet, file = "Plots/CSI_subcats.pdf", device = cairo_pdf,dpi = 300)
#embedFonts(file = "Plots/CSI_online30_subcats.pdf")

```

# Correct trials only
```{r}
# descriptives 
(means_unvalidtoNA <- Rmisc::summarySEwithin(df[df$category != "Filler",],"timing.01",idvar = "subject",withinvars = "PosOr", na.rm = T))
```



### Plot RTs by OrPos

```{r}
plotting <- df %>% filter(correct == 1) %>%
  mutate(kind = case_when(category == "Filler" ~"Filler",
                          category != "Filler" ~"Experimental"))

(plot <- ggplot(data=plotting[plotting$category != "Filler",], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms")+
  annotate(geom="text", x=2, y=1200, label="n = 30", color="black", size = 8))

(plot2 <- ggplot(data=plotting, aes(x=PosOr, y=timing.01, group=kind, color = kind)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms", color = "Trial type")+
  annotate(geom="text", x=2, y=1300, label="n = 30", color="black", size = 8))


# ggsave(plot = plot, file = "figures/RT_across_conditions.pdf", device = cairo_pdf, dpi = 300)
# embedFonts(file = "figures/RT_across_conditions_CSI_online_typing.pdf")
```
  
Plot by subcategory
```{r}
plotting <- df %>% filter(correct == 1) %>%
  mutate(kind = case_when(category == "Filler" ~"Filler",
                          category != "Filler" ~"Experimental"))
(plot_by_cat <- ggplot(data=plotting[plotting$category != "Filler" ,], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  facet_wrap(~category) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms"))
#ggsave(plot = plot30_facet, file = "Plots/CSI_subcats.pdf", device = cairo_pdf,dpi = 300)
#embedFonts(file = "Plots/CSI_online30_subcats.pdf")

```

Plot by subject: 
```{r}
plotting <- df %>% filter(correct == 1) %>%
  mutate(kind = case_when(category == "Filler" ~"Filler",
                          category != "Filler" ~"Experimental"))
(plot_by_cat <- ggplot(data=df[df$category != "Filler",], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  facet_wrap(~subject) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms"))
#ggsave(plot = plot30_facet, file = "Plots/CSI_subcats.pdf", device = cairo_pdf,dpi = 300)
#embedFonts(file = "Plots/CSI_online30_subcats.pdf")

```

### Control: Plot Rts of Fillers

```{r}
(plot <- ggplot(data=plotting[plotting$category == "Filler",], aes(x=PosOr, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  apatheme+
  labs(x="Ordinal Position ",y ="RT ms")+
  annotate(geom="text", x=2, y=1200, label="n = 30", color="black", size = 8))
```

### Control: Plot RTs accross the experiment
```{r}
(plot <- ggplot(data=df, aes(x=trial, y=timing.01)) +
  stat_summary(fun=mean,  geom="point", size = 2)+
  stat_summary(fun=mean,  geom="line", size = 1) +
  apatheme+
  labs(x="Trial ",y ="RT ms")+
  annotate(geom="text", x=20, y=1570, label="n = 30", color="black", size = 8))
```

# lmms 

```{r}
hist(df$timing.01)

# Full GLMM with polynomial contrasts
contrasts(df$PosOr) <- contr.poly(5)
# m1 <- glmer(timing.01 ~ PosOr + (PosOr|subject) +(PosOr|category) ,
#              data = df[df$category != "Filler"  & df$correct == 1,], family =Gamma(link ="identity"), control=glmerControl(optimizer = "bobyqa"))
#model does not converge
m1 <- glmer(timing.01 ~ PosOr + (PosOr|subject) +(PosOr|category) , 
             data = df[df$category != "Filler"  & df$correct == 1,], family =Gamma(link ="identity"), control=glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 2*10^5)))
summary(m1)

# linear trend only
fixef_terms <- model.matrix( ~ PosOr,df) 
df$PosOr.L <- fixef_terms[,2]
m2 <- afex::lmer_alt(timing.01 ~ PosOr.L + (PosOr.L||subject) +(1|category) , 
             data = df[df$category != "Filler"  & df$correct == 1,], family =Gamma(link ="identity"), control=glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 2*10^5)))
summary(m2)

# Ordinal position as continuous predictor variable
df$PosOr.cont <- scale(as.numeric(as.character(df$PosOr)), center = T, scale = F)
m3 <- glmer(timing.01 ~ PosOr.cont + (PosOr.cont|subject) +(PosOr.cont|category) ,
             data = df[df$category != "Filler"  & df$correct == 1,], family =Gamma(link ="identity"), control=glmerControl(optimizer = "bobyqa"))
summary(m3)
```
